<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Webhook Configuration - M5V</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            /* Light theme variables */
            --primary: #1a73e8;
            --secondary: #5f6368;
            --success: #0f9d58;
            --danger: #d93025;
            --warning: #f9ab00;
            --bg-light: #f1f3f4;
            --bg-white: #e8eaed;
            --text-dark: #202124;
            --card-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            --border-color: #dadce0;
            --logo-primary: #1a73e8;
            --logo-shadow: rgba(26, 115, 232, 0.5);
            --font-primary: 'Inter', 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            
            /* Nuevo tema de gradiente */
            --gradient-start: #0f2027;
            --gradient-mid: #203a43;
            --gradient-end: #2c5364;
            --accent-color: #4facfe;
            --accent-glow: rgba(79, 172, 254, 0.6);
            --particle-color: rgba(255, 255, 255, 0.5);
            --wave-color-1: rgba(79, 172, 254, 0.1);
            --wave-color-2: rgba(79, 172, 254, 0.05);
            --text-color: #ffffff;
        }

        /* Dark theme variables */
        html[data-theme='dark'] {
            --primary: #8ab4f8;
            --secondary: #9aa0a6;
            --success: #81c995;
            --danger: #f28b82;
            --warning: #fdd663;
            --bg-light: #202124;
            --bg-white: #292a2d;
            --text-dark: #e8eaed;
            --card-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            --border-color: #3c4043;
            --logo-primary: #8ab4f8;
            --logo-shadow: rgba(138, 180, 248, 0.5);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            transition: background-color 0.3s, color 0.3s;
        }
        
        body {
            font-family: var(--font-primary);
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-mid), var(--gradient-end));
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            position: relative;
            overflow-x: hidden;
        }

        /* Estilos para el fondo con gradiente y ondas */
        .gradient-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-mid), var(--gradient-end));
        }

        /* Ondas suaves */
        .wave {
            position: absolute;
            width: 100%;
            height: 100px;
            background: var(--wave-color-1);
            border-radius: 50%;
            transform: scale(2);
            opacity: 0.3;
            animation: wave-animation 15s infinite linear;
        }

        .wave:nth-child(2) {
            background: var(--wave-color-2);
            animation-delay: -5s;
            animation-duration: 20s;
            transform: scale(1.8) rotate(30deg);
        }

        .wave:nth-child(3) {
            background: var(--wave-color-1);
            animation-delay: -10s;
            animation-duration: 25s;
            transform: scale(1.5) rotate(60deg);
        }

        /* Part√≠culas flotantes */
        .particle {
            position: absolute;
            background-color: var(--particle-color);
            border-radius: 50%;
            opacity: 0;
            animation: float-animation 8s infinite ease-in-out;
        }

        /* Animaciones */
        @keyframes wave-animation {
            0% {
                transform-origin: center;
                transform: scale(1.5) rotate(0deg);
            }
            50% {
                transform: scale(1.8) rotate(180deg);
            }
            100% {
                transform: scale(1.5) rotate(360deg);
            }
        }

        @keyframes float-animation {
            0% {
                transform: translateY(0) translateX(0);
                opacity: 0;
            }
            25% {
                opacity: 0.5;
            }
            50% {
                transform: translateY(-20px) translateX(10px);
                opacity: 0.8;
            }
            75% {
                opacity: 0.5;
            }
            100% {
                transform: translateY(0) translateX(0);
                opacity: 0;
            }
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }
        
        header {
            background-color: rgba(32, 58, 67, 0.7);
            backdrop-filter: blur(10px);
            color: var(--text-color);
            padding: 20px;
            text-align: center;
            margin-bottom: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            position: relative;
            border: 1px solid rgba(79, 172, 254, 0.2);
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 0;
        }

        .logo-text {
            font-family: var(--font-primary);
            font-weight: 700;
            font-size: 28px;
            color: var(--accent-color);
            text-align: center;
            background-color: rgba(79, 172, 254, 0.1);
            padding: 5px 15px;
            border-radius: 6px;
            box-shadow: 0 0 15px var(--accent-glow);
            margin-right: 15px;
            letter-spacing: 1px;
            text-shadow: 0 0 10px var(--accent-glow);
        }

        header h1 {
            margin: 0;
            font-size: 2rem;
            color: var(--text-color);
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        header h1::before {
            content: "";
            display: none;
        }

        .back-link {
            position: absolute;
            top: 20px;
            left: 20px;
            color: var(--text-color);
            text-decoration: none;
            display: flex;
            align-items: center;
            font-size: 16px;
            opacity: 0.8;
            transition: all 0.3s ease;
        }

        .back-link:hover {
            opacity: 1;
            text-shadow: 0 0 8px var(--text-color);
        }

        /* Theme selector */
        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--text-color);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(79, 172, 254, 0.3);
            z-index: 100;
        }

        .theme-toggle:hover {
            background-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 0 15px rgba(79, 172, 254, 0.5);
        }

        .theme-toggle i {
            font-size: 18px;
        }
        
        .card {
            background-color: rgba(32, 58, 67, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            padding: 20px;
            margin-bottom: 30px;
            transition: transform 0.3s, box-shadow 0.3s;
            border: 1px solid rgba(79, 172, 254, 0.1);
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(79, 172, 254, 0.2);
        }
        
        .card h2 {
            color: var(--accent-color);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(79, 172, 254, 0.2);
        }

        .webhook-section {
            margin-bottom: 30px;
        }

        .webhook-url {
            background-color: rgba(15, 32, 39, 0.7);
            padding: 15px;
            padding-right: 75px;
            border-radius: 5px;
            font-family: monospace;
            margin: 15px 0;
            word-break: break-all;
            color: var(--text-color);
            border: 1px solid rgba(79, 172, 254, 0.2);
        }

        .copy-btn {
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            font-size: 12px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            box-shadow: 0 0 10px rgba(79, 172, 254, 0.3);
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 5;
            width: auto;
            min-width: 60px;
            height: 28px;
        }

        .copy-btn i {
            margin-right: 5px;
            font-size: 12px;
        }

        .copy-btn:hover {
            background-color: #00a0ff;
            box-shadow: 0 0 15px rgba(79, 172, 254, 0.5);
            transform: translateY(-50%) scale(1.05);
        }

        .copy-btn:active {
            transform: translateY(-50%) scale(0.95);
        }

        /* Estilo para el efecto active */
        .copy-btn.active {
            background-color: #00c853;
            transform: translateY(-50%) scale(0.95);
            box-shadow: 0 0 15px rgba(0, 200, 83, 0.5);
        }

        /* Ajuste para el efecto active en json-structure */
        .json-structure .copy-btn.active {
            transform: scale(0.95);
            background-color: #00c853;
            box-shadow: 0 0 15px rgba(0, 200, 83, 0.5);
        }

        .step {
            margin-bottom: 20px;
            padding-left: 20px;
            border-left: 3px solid var(--accent-color);
            color: var(--text-color);
        }

        .step h3 {
            color: var(--accent-color);
            margin-bottom: 10px;
        }

        .step p {
            margin-bottom: 10px;
            color: var(--text-color);
        }

        .step img {
            max-width: 100%;
            margin: 10px 0;
            border: 1px solid rgba(79, 172, 254, 0.2);
            border-radius: 5px;
        }

        .regenerate-btn {
            background-color: var(--secondary);
            color: var(--text-color);
            border: none;
            border-radius: 4px;
            padding: 10px 15px;
            cursor: pointer;
            font-size: 14px;
            display: inline-block;
            margin-top: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(161, 161, 161, 0.3);
        }

        .regenerate-btn:hover {
            background-color: #b0b0b0;
            transform: translateY(-2px);
            box-shadow: 0 0 15px rgba(161, 161, 161, 0.5);
        }

        .token-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 15px 0;
        }
        
        .token-container input {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid rgba(79, 172, 254, 0.2);
            border-radius: 4px;
            background-color: rgba(15, 32, 39, 0.7);
            color: var(--text-color);
            font-family: monospace;
        }

        .generate-token-btn {
            background-color: var(--secondary);
            color: var(--text-color);
            border: none;
            border-radius: 4px;
            padding: 10px 15px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(161, 161, 161, 0.3);
        }

        .generate-token-btn:hover {
            background-color: #b0b0b0;
            transform: translateY(-2px);
            box-shadow: 0 0 15px rgba(161, 161, 161, 0.5);
        }

        .webhook-config-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }

        .webhook-config {
            flex: 1;
            min-width: 300px;
            padding: 20px;
            border: 1px solid rgba(79, 172, 254, 0.2);
            border-radius: 5px;
            background-color: rgba(15, 32, 39, 0.7);
            color: var(--text-color);
        }

        .webhook-config h4 {
            margin-bottom: 12px;
            color: var(--accent-color);
            font-weight: 500;
        }

        .webhook-config p {
            margin-bottom: 15px;
            font-size: 15px;
            line-height: 1.5;
            color: var(--text-color);
        }

        .webhook-config pre {
            background-color: rgba(15, 32, 39, 0.7);
            padding: 12px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 13px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            color: var(--text-color);
            border: 1px solid rgba(79, 172, 254, 0.1);
        }

        .config-item {
            margin-bottom: 20px;
        }

        .config-item label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 15px;
            color: var(--text-color);
        }

        .input-group, .input-with-copy {
            position: relative;
        }

        .input-group {
            display: flex;
            width: 100%;
            margin-bottom: 15px;
        }

        .input-group input {
            width: 100%;
            padding: 10px;
            padding-right: 75px;
            border: 1px solid rgba(79, 172, 254, 0.2);
            border-radius: 4px;
            font-size: 14px;
            background-color: rgba(15, 32, 39, 0.7);
            color: var(--text-color);
        }

        .input-with-copy {
            width: 100%;
            margin-bottom: 15px;
        }

        .input-with-copy input {
            width: 100%;
            padding: 10px;
            padding-right: 75px;
            border: 1px solid rgba(79, 172, 254, 0.2);
            border-radius: 4px;
            font-size: 14px;
            background-color: rgba(15, 32, 39, 0.7);
            color: var(--text-color);
        }

        small {
            display: block;
            margin-top: 6px;
            color: var(--secondary);
            font-size: 13px;
        }

        .setup-steps {
            margin-top: 25px;
            margin-bottom: 25px;
            background-color: rgba(15, 32, 39, 0.7);
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid var(--accent-color);
            color: var(--text-color);
        }

        .setup-steps h3 {
            margin-bottom: 12px;
            color: var(--accent-color);
            font-size: 16px;
        }

        .setup-steps ol {
            padding-left: 20px;
            color: var(--text-color);
        }

        .setup-steps li {
            margin-bottom: 8px;
            line-height: 1.5;
        }

        .test-webhook {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .btn {
            display: inline-block;
            padding: 10px 18px;
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.25s ease;
            box-shadow: 0 0 10px rgba(79, 172, 254, 0.3);
            position: relative;
            overflow: hidden;
        }

        .btn::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.1);
            opacity: 0;
            transition: opacity 0.2s;
        }

        .btn:hover {
            background-color: #00a0ff;
            transform: translateY(-2px);
            box-shadow: 0 0 15px rgba(79, 172, 254, 0.5);
        }
        
        .btn:hover::after {
            opacity: 1;
        }
        
        .btn:active {
            transform: translateY(1px);
            box-shadow: 0 0 8px rgba(79, 172, 254, 0.3);
        }
        
        .btn.secondary {
            background-color: var(--secondary);
            color: white;
            box-shadow: 0 0 10px rgba(161, 161, 161, 0.3);
        }
        
        .btn.secondary:hover {
            background-color: #b0b0b0;
            transform: translateY(-2px);
            box-shadow: 0 0 15px rgba(161, 161, 161, 0.5);
        }
        
        .btn.success {
            background-color: var(--secondary);
            box-shadow: 0 0 10px rgba(161, 161, 161, 0.3);
        }
        
        .btn.success:hover {
            background-color: #b0b0b0;
            box-shadow: 0 0 15px rgba(161, 161, 161, 0.5);
        }

        .status-indicator {
            font-size: 14px;
            margin-left: 10px;
            color: var(--text-color);
        }

        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: var(--text-color);
            font-size: 14px;
            border-top: 1px solid rgba(79, 172, 254, 0.1);
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            background-color: var(--secondary);
            color: white;
            border-radius: 6px;
            box-shadow: 0 0 20px rgba(161, 161, 161, 0.5);
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 1000;
            display: flex;
            align-items: center;
            font-weight: 500;
        }

        .notification::before {
            content: "‚úì";
            margin-right: 8px;
            font-weight: bold;
        }

        .notification.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            header h1 {
                font-size: 1.5rem;
            }
            
            .card {
                padding: 15px;
            }
            
            .theme-toggle {
                top: 10px;
                right: 10px;
            }

            .back-link {
                top: 10px;
                left: 10px;
            }

            .webhook-config {
                min-width: 100%;
            }
        }

        /* Add these styles to the end of existing styles */
        .settings-form {
            background-color: var(--bg-light);
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        
        .form-group {
            margin-bottom: 15px;
            position: relative;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .form-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 14px;
            background-color: var(--bg-white);
            color: var(--text-dark);
        }
        
        .toggle-password {
            position: absolute;
            right: 80px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            color: var(--secondary);
            z-index: 5;
        }
        
        .save-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 10px 15px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
            font-weight: 500;
            transition: all 0.25s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .save-btn:hover {
            background-color: #0b5fca;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        
        .save-btn:active {
            transform: translateY(1px);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        .test-btn {
            background-color: var(--secondary);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 10px 15px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 15px;
            font-weight: 500;
            transition: all 0.25s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .test-btn:hover {
            background-color: #4a4e52;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        
        .test-btn:active {
            transform: translateY(1px);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        .test-connection-container {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 10px;
        }
        
        #connection-status {
            font-size: 14px;
        }
        
        .connection-success {
            color: var(--success);
        }
        
        .connection-error {
            color: var(--danger);
        }

        /* Eliminar estilos de parallax que no se usar√°n */
        .parallax-container, .parallax-bg, .parallax-content {
            display: none;
        }

        /* Add Google Font link for Inter */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        /* JSON Structure styles */
        .json-structure {
            margin-bottom: 20px;
        }
        
        .json-structure pre {
            background-color: var(--bg-white);
            padding: 15px;
            padding-right: 75px;
            border-radius: 5px;
            overflow-x: auto;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.5;
            border: 1px solid var(--border-color);
        }
        
        .json-structure h4 {
            margin-bottom: 10px;
            color: var(--primary);
            font-size: 14px;
            font-weight: 500;
        }
        
        .json-structure .copy-btn {
            top: 15px;
            transform: none;
        }

        .info-box {
            background-color: var(--bg-white);
            border-left: 4px solid var(--primary);
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }
        
        .info-box i {
            color: var(--primary);
            font-size: 18px;
            margin-top: 2px;
        }
        
        .info-box p {
            margin: 0;
            font-size: 14px;
            line-height: 1.5;
        }

        /* A√±adir estos estilos para centrar correctamente el logo M5V */
        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
        }

        .logo-text {
            font-family: var(--font-primary);
            font-weight: 700;
            font-size: 24px;
            color: var(--primary);
            text-align: center;
            margin-left: 10px;
        }

        /* Mejorar los estilos de los botones secundarios */
        .btn.secondary {
            background-color: #5f6368;
            color: white;
            border: none;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
        }

        .btn.secondary:hover {
            background-color: #4a4e52;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        /* Mejorar los estilos de los botones de acci√≥n API */
        .api-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .api-actions .btn {
            min-width: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* A√±adir estilos para los botones de input-group */
        .input-group {
            position: relative;
            display: flex;
            width: 100%;
            margin-bottom: 10px;
        }

        .input-group input {
            flex: 1;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 14px;
            background-color: var(--bg-white);
            color: var(--text-dark);
            padding-right: 90px;
        }

        .input-group .copy-btn {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 10;
            width: auto;
            min-width: 70px;
        }
    </style>
</head>
<body>
    <div class="gradient-background" id="gradient-background"></div>
    <div class="container">
        <header>
            <div class="logo-container">
                <span class="logo-text">M5V</span>
                <h1>Webhook Configuration</h1>
            </div>
            <a href="index.html" class="back-link">‚Üê Back to Dashboard</a>
            <button class="theme-toggle" id="theme-toggle" title="Toggle Theme">
                <i class="fas fa-sun"></i>
            </button>
        </header>

        <div class="card">
            <h2>ManyChat Integration</h2>
            <p>Configure your ManyChat webhook to connect with our system.</p>
            
            <div class="webhook-config">
                <div class="config-item">
                    <label for="webhook-url">Webhook URL:</label>
                    <div class="input-group">
                        <input type="text" id="webhook-url" class="form-control" readonly>
                        <button class="copy-btn" data-target="webhook-url"><i class="fas fa-copy"></i> Copy</button>
                    </div>
                </div>
                
                <div class="config-item">
                    <label for="webhook-token">Authentication Token:</label>
                    <div class="input-group">
                        <input type="text" id="webhook-token" class="form-control" value="mc_12345" readonly>
                        <button class="copy-btn" data-target="webhook-token"><i class="fas fa-copy"></i> Copy</button>
                    </div>
                </div>
                
                <div class="config-item">
                    <label>Generate New Webhook:</label>
                    <button class="btn secondary" id="generate-webhook">Generate New Webhook</button>
                    <small>Click to generate a new webhook URL and path if needed.</small>
                </div>
                
                <div class="config-item">
                    <label>JSON Structure:</label>
                    <div class="json-structure">
                        <h4>Request Format (ManyChat to System):</h4>
                        <pre id="request-json">{
  "user": {
    "id": "{{user_id}}",
    "name": "{{first_name}} {{last_name}}",
    "phone": "{{phone}}",
    "email": "{{email}}"
  },
  "message": {
    "text": "{{last_input_text}}",
    "timestamp": "{{current_date}}"
  },
  "metadata": {
    "platform": "facebook",
    "source": "messenger",
    "flow_id": "{{flow_id}}"
  }
}</pre>
                        <button class="copy-btn" data-target="request-json"><i class="fas fa-copy"></i> Copy</button>
                    </div>
                    <div class="json-structure">
                        <h4>Response Format (System to ManyChat):</h4>
                        <pre id="response-json">{
  "success": true,
  "conversation_id": "conv_{{user_id}}",
  "response": {
    "text": "Thank you for your message. Our system is processing your request.",
    "timestamp": "{{current_date}}"
  },
  "action": "process_request",
  "status": "pending"
}</pre>
                        <button class="copy-btn" data-target="response-json"><i class="fas fa-copy"></i> Copy</button>
                    </div>
                    <small>Use these JSON structures as reference for your webhook integration. ManyChat variables like {{user_id}} will be replaced with actual values.</small>
                </div>
                
                <div class="setup-steps">
                    <h3>Setup Steps:</h3>
                    <ol>
                        <li>Go to your ManyChat dashboard</li>
                        <li>Navigate to Settings > Integrations > Webhooks</li>
                        <li>Add a new webhook with the URL above</li>
                        <li>Set the content type to "application/json"</li>
                        <li>Add a header "Authorization" with the token above</li>
                        <li>Save your settings</li>
                    </ol>
                </div>
                
                <div class="test-webhook">
                    <button class="btn" id="test-manychat">Test Connection</button>
                    <span class="status-indicator" id="manychat-status"></span>
                </div>
            </div>
        </div>
        
        <!-- Nueva secci√≥n para ManyChat API Integration -->
        <div class="card">
            <h2>ManyChat API Integration</h2>
            <p>Connect directly to ManyChat API to send messages and manage subscribers.</p>
            
            <div class="webhook-config">
                <div class="config-item">
                    <label>ManyChat API Key:</label>
                    <div class="input-with-copy">
                        <input type="password" id="manychat-api-key" placeholder="Enter your ManyChat API Key">
                        <button class="toggle-password" onclick="togglePasswordVisibility('manychat-api-key')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    <small>Get this from your ManyChat dashboard under Settings > API.</small>
                </div>
                
                <div class="config-item">
                    <label>Page ID:</label>
                    <div class="input-with-copy">
                        <input type="text" id="manychat-page-id" placeholder="Enter your Facebook Page ID">
                    </div>
                    <small>Your Facebook Page ID associated with ManyChat.</small>
                </div>
                
                <div class="config-item">
                    <label>API Actions:</label>
                    <div class="api-actions">
                        <button class="btn secondary" id="get-subscribers">Get Subscribers</button>
                        <button class="btn secondary" id="get-tags">Get Tags</button>
                        <button class="btn secondary" id="get-flows">Get Flows</button>
                    </div>
                    <small>Test API functionality by retrieving data from ManyChat.</small>
                </div>
                
                <div class="config-item">
                    <label>API Response:</label>
                    <div class="json-structure">
                        <pre id="api-response" style="min-height: 150px;">// API response will appear here</pre>
                    </div>
                </div>
                
                <div class="config-item">
                    <label>Example API Usage:</label>
                    <div class="json-structure">
                        <h4>Send Message to Subscriber:</h4>
                        <pre id="send-message-example">{
  "subscriber_id": "subscriber_id_here",
  "data": {
    "messages": [
      {
        "type": "text",
        "text": "Hello from your application!"
      }
    ]
  }
}</pre>
                        <button class="copy-btn" data-target="send-message-example"><i class="fas fa-copy"></i> Copy</button>
                    </div>
                    <div class="json-structure">
                        <h4>Add Tag to Subscriber:</h4>
                        <pre id="add-tag-example">{
  "subscriber_id": "subscriber_id_here",
  "tag_name": "your_tag_name"
}</pre>
                        <button class="copy-btn" data-target="add-tag-example"><i class="fas fa-copy"></i> Copy</button>
                    </div>
                </div>
                
                <div class="setup-steps">
                    <h3>Integration Steps:</h3>
                    <ol>
                        <li>Go to your ManyChat dashboard</li>
                        <li>Navigate to Settings > API</li>
                        <li>Generate a new API Key</li>
                        <li>Copy and paste the API Key above</li>
                        <li>Save your settings</li>
                        <li>Use the API to send messages, manage subscribers, and more</li>
                    </ol>
                </div>
                
                <div class="test-webhook">
                    <button class="btn success" id="save-manychat-api">Save API Configuration</button>
                    <button class="btn" id="test-manychat-api">Test API Connection</button>
                    <span class="status-indicator" id="manychat-api-status"></span>
                </div>
            </div>
        </div>
        
        <!-- Nueva secci√≥n para ManyChat JSON App -->
        <div class="card">
            <h2>ManyChat JSON App Example</h2>
            <p>Use this JSON structure to create a custom app in ManyChat that integrates with our system.</p>
            
            <div class="webhook-config">
                <div class="config-item">
                    <label>ManyChat JSON App Structure:</label>
                    <div class="json-structure">
                        <button class="copy-btn" data-target="manychat-json"><i class="fas fa-copy"></i> Copy</button>
                        <pre id="manychat-json">
{
  "user_id": "{{user_id}}",
  "first_name": "{{first_name}}",
  "last_name": "{{last_name}}",
  "gender": "{{gender}}",
  "phone": "{{phone}}",
  "email": "{{email}}",
  "messenger_id": "{{messenger_user_id}}",
  "page_id": "{{page_id}}",
  "action": "new_subscriber",
  "timestamp": "{{current_date}}"
}
                        </pre>
                    </div>
                    <small>Copy this JSON structure and use it in ManyChat to create a custom app that integrates with our system. Replace {{Your Webhook URL}} and {{Your Auth Token}} with your actual values.</small>
                </div>
                
                <div class="config-item">
                    <label>Pok√©mon Integration Example:</label>
                    <div class="json-structure">
                        <pre id="pokemon-json-app">{
  "sources": [
    {
      "name": "pokemon_list",
      "type": "enum:rpc",
      "request": {
        "url": "https://pokeapi.co/api/v2/pokemon/",
        "method": "GET",
        "headers": [
          {
            "Content-Type": "application/json"
          }
        ]
      },
      "mapping": [
        {
          "type": "select",
          "path": "$.results",
          "key": "$.name",
          "value": "$.url"
        }
      ],
      "payload": null
    }
  ],
  "fields": [
    {
      "name": "weight",
      "path": "$.weight",
      "type": "number",
      "title": "Pok√©mon weight"
    }
  ],
  "payload": null,
  "description": "quiz game with random questions"
}</pre>
                        <button class="copy-btn" data-target="pokemon-json-app"><i class="fas fa-copy"></i> Copy</button>
                    </div>
                    <small>This example shows how to integrate with the Pok√©mon API to fetch a list of Pok√©mon and their details. You can use this as a template for your own custom integrations.</small>
                </div>
                
                <div class="info-box">
                    <i class="fas fa-info-circle"></i>
                    <p>This JSON structure is compatible with ManyChat's custom app feature. You can customize the fields and structure based on your specific needs. The example includes user data, message content, and metadata that will be sent to your webhook.</p>
                </div>
                
                <div class="setup-steps">
                    <h3>How to Use This JSON in ManyChat:</h3>
                    <ol>
                        <li>Go to your ManyChat dashboard</li>
                        <li>Navigate to Settings > Custom App</li>
                        <li>Create a new app</li>
                        <li>Paste this JSON structure</li>
                        <li>Replace the placeholders with your actual values</li>
                        <li>Save and activate your app</li>
                    </ol>
                </div>
            </div>
        </div>
        
        <div class="card">
            <h2>n8n Integration</h2>
            <p>Configure n8n to process your webhook data.</p>
            
            <div class="webhook-config">
                <div class="config-item">
                    <label>Webhook URL (from n8n):</label>
                    <div class="input-with-copy">
                        <input type="text" id="n8n-url" placeholder="Enter your n8n webhook URL here">
                        <button class="copy-btn" data-target="n8n-url"><i class="fas fa-copy"></i></button>
                    </div>
                    <small>Enter the webhook URL provided by your n8n instance. Example: https://primary-production-cdd4.up.railway.app/webhook-test/whatsapp</small>
                </div>
                
                <div class="config-item">
                    <label>Authentication Token:</label>
                    <div class="input-with-copy">
                        <input type="text" id="n8n-token" value="n8n_67890" placeholder="Enter a simple token">
                        <button class="copy-btn" data-target="n8n-token"><i class="fas fa-copy"></i></button>
                    </div>
                    <small>Add this token to your n8n webhook node for authentication.</small>
                </div>
                
                <div class="setup-steps">
                    <h3>Setup Steps for n8n:</h3>
                    <ol>
                        <li>Open your n8n instance</li>
                        <li>Create a new workflow or edit an existing one</li>
                        <li>Add a "Webhook" trigger node</li>
                        <li>Set HTTP Method to "POST"</li>
                        <li>Enable "Respond to Webhook" and select "When last node finishes"</li>
                        <li>Copy the webhook URL from n8n and paste it above</li>
                        <li>Add the authentication token to your workflow</li>
                        <li>Save your workflow and activate it</li>
                    </ol>
                </div>
                
                <div class="test-webhook">
                    <button class="btn primary" id="save-n8n">Save Configuration</button>
                    <button class="btn secondary" id="test-n8n">Test Connection</button>
                    <span class="status-indicator" id="n8n-status"></span>
                </div>
            </div>
        </div>
        
        <div class="card">
            <h2>Advanced Settings</h2>
            <p>Configure additional webhook settings.</p>
            
            <div class="webhook-config">
                <div class="config-item">
                    <label>Retry Attempts:</label>
                    <select id="retry-attempts">
                        <option value="1">1</option>
                        <option value="3" selected>3</option>
                        <option value="5">5</option>
                        <option value="10">10</option>
                    </select>
                    <small>Number of retry attempts if a webhook fails.</small>
                </div>
                
                <div class="config-item">
                    <label>Timeout (seconds):</label>
                    <input type="number" id="timeout" value="30" min="5" max="120">
                    <small>Maximum time to wait for a webhook response.</small>
                </div>
                
                <div class="config-item">
                    <label>Logging Level:</label>
                    <select id="logging-level">
                        <option value="error">Error Only</option>
                        <option value="warning">Warning & Error</option>
                        <option value="info" selected>Info, Warning & Error</option>
                        <option value="debug">Debug (Verbose)</option>
                    </select>
                    <small>Level of detail for webhook logs.</small>
                </div>
                
                <div class="test-webhook">
                    <button class="btn success" id="save-advanced">Save Settings</button>
                </div>
            </div>
        </div>
        
        <!-- Restaurando la secci√≥n de Supabase -->
        <div class="card">
            <h2>Supabase Connection</h2>
            <p>Configure connection with Supabase to store messages and webhook data:</p>
            
            <div class="webhook-section">
                <div class="settings-form">
                    <div class="form-group">
                        <label for="supabase-url">Supabase URL:</label>
                        <input type="text" id="supabase-url" placeholder="Ex: https://abcdefghijklm.supabase.co" value="">
                    </div>
                    
                    <div class="form-group">
                        <label for="supabase-key">Supabase API Key:</label>
                        <input type="password" id="supabase-key" placeholder="Enter your Supabase API Key" value="">
                        <button type="button" class="toggle-password" onclick="togglePasswordVisibility('supabase-key')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    
                    <div class="form-group">
                        <label for="supabase-table">Table Name:</label>
                        <input type="text" id="supabase-table" placeholder="Ex: messages" value="messages">
                    </div>
                    
                    <div class="form-group">
                        <div class="info-box">
                            <i class="fas fa-info-circle"></i>
                            <p>Supabase connection is required for the webhook system to store and retrieve messages. Without this connection, the system will not be able to maintain conversation history.</p>
                        </div>
                    </div>
                    
                    <button class="save-btn" onclick="saveSupabaseConfig()">Save Supabase Configuration</button>
                </div>
                
                <div class="test-connection-container">
                    <button class="test-btn" onclick="testSupabaseConnection()">Test Connection</button>
                    <span id="connection-status"></span>
                </div>
            </div>
        </div>
        
        <footer>
            &copy; 2023 <span class="logo-text">M5V</span> Webhook Manager. All rights reserved.
        </footer>
    </div>

    <div class="notification" id="notification">Copied to clipboard!</div>
    
    <!-- Link to JavaScript file -->
    <script src="webhook-settings.js"></script>

    <script>
        // Initialize the interface
        document.addEventListener('DOMContentLoaded', function() {
            // Crear el fondo de gradiente
            createCosmicBackground();
            
            // Theme selector configuration
            const htmlElement = document.documentElement;
            const themeToggle = document.getElementById('theme-toggle');
            
            // Load saved theme
            const savedTheme = localStorage.getItem('theme') || 'light';
            htmlElement.setAttribute('data-theme', savedTheme);
            updateThemeToggleIcon(savedTheme);
            
            // Function to toggle theme
            themeToggle.addEventListener('click', () => {
                const currentTheme = htmlElement.getAttribute('data-theme');
                const newTheme = currentTheme === 'light' ? 'dark' : 'light';
                
                htmlElement.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                
                updateThemeToggleIcon(newTheme);
            });
            
            function updateThemeToggleIcon(theme) {
                themeToggle.innerHTML = theme === 'light' ? 
                    '<i class="fas fa-sun"></i>' : 
                    '<i class="fas fa-moon"></i>';
            }
            
            // Funci√≥n para generar la URL del webhook
            const generateWebhookUrl = () => {
                const currentDomain = window.location.origin || 'https://example.com';
                const webhookUrl = `${currentDomain}/api/webhooks/manychat`;
                
                // Actualizar el campo de entrada
                document.getElementById('webhook-url').value = webhookUrl;
            };
            
            // Funci√≥n para generar un webhook aleatorio
            const generateRandomWebhook = () => {
                const randomId = Math.random().toString(36).substring(2, 10);
                const currentDomain = window.location.origin || 'https://example.com';
                const newWebhookUrl = `${currentDomain}/api/webhooks/manychat/${randomId}`;
                
                // Actualizar el campo de entrada
                document.getElementById('webhook-url').value = newWebhookUrl;
                
                // Generar un token simple
                const simpleToken = `mc_${randomId}`;
                document.getElementById('webhook-token').value = simpleToken;
                
                // Guardar en localStorage
                localStorage.setItem('manychat_webhook_url', newWebhookUrl);
                localStorage.setItem('manychat_token', simpleToken);
                
                // Mostrar notificaci√≥n
                showNotification('New webhook generated!');
            };
            
            // Bot√≥n para generar webhook
            const generateWebhookBtn = document.getElementById('generate-webhook');
            if (generateWebhookBtn) {
                generateWebhookBtn.addEventListener('click', generateRandomWebhook);
            }
            
            // Seleccionar todos los botones de copia
            const copyButtons = document.querySelectorAll('.copy-btn');
            const notification = document.getElementById('notification');
            
            // Funci√≥n para mostrar notificaci√≥n
            const showNotification = (message) => {
                if (!notification) return;
                
                notification.textContent = message;
                notification.classList.add('show');
                
                // Ocultar despu√©s de 2 segundos
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 2000);
            };
            
            // Funci√≥n para copiar texto
            const copyText = (text) => {
                // Usar el nuevo API de clipboard si est√° disponible
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    return navigator.clipboard.writeText(text)
                        .then(() => {
                            showNotification('Copied to clipboard!');
                            return true;
                        })
                        .catch(err => {
                            console.error('Failed to copy: ', err);
                            return false;
                        });
                }
                
                // Fallback para navegadores que no soportan clipboard API
                const textarea = document.createElement('textarea');
                textarea.value = text;
                textarea.style.position = 'fixed';
                textarea.style.opacity = '0';
                document.body.appendChild(textarea);
                textarea.select();
                
                try {
                    const successful = document.execCommand('copy');
                    document.body.removeChild(textarea);
                    
                    if (successful) {
                        showNotification('Copied to clipboard!');
                        return true;
                    }
                } catch (err) {
                    console.error('Failed to copy: ', err);
                    document.body.removeChild(textarea);
                    return false;
                }
                
                return false;
            };
            
            // Agregar evento a cada bot√≥n de copia
            copyButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const targetId = button.getAttribute('data-target');
                    if (!targetId) return;
                    
                    const targetElement = document.getElementById(targetId);
                    if (!targetElement) return;
                    
                    let textToCopy = '';
                    
                    if (targetElement.tagName.toLowerCase() === 'input') {
                        textToCopy = targetElement.value;
                    } else if (targetElement.tagName.toLowerCase() === 'pre') {
                        textToCopy = targetElement.textContent;
                    } else {
                        textToCopy = targetElement.innerText;
                    }
                    
                    copyText(textToCopy);
                    
                    // Efecto visual en el bot√≥n
                    button.classList.add('active');
                    setTimeout(() => {
                        button.classList.remove('active');
                    }, 200);
                });
            });
            
            // Funci√≥n para probar la conexi√≥n con ManyChat
            const testManyChatBtn = document.getElementById('test-manychat');
            if (testManyChatBtn) {
                testManyChatBtn.addEventListener('click', function() {
                    const statusElement = document.getElementById('manychat-status');
                    if (!statusElement) return;
                    
                    const webhookUrl = document.getElementById('webhook-url')?.value || '';
                    const token = document.getElementById('webhook-token')?.value || '';
                    
                    if (!webhookUrl || !token) {
                        statusElement.textContent = 'Error: Please fill in all fields';
                        statusElement.className = 'connection-error';
                        return;
                    }
                    
                    // Simular prueba de conexi√≥n
                    statusElement.textContent = 'Testing connection...';
                    statusElement.className = '';
                    
                    // Simular respuesta despu√©s de 1 segundo
                    setTimeout(() => {
                        const success = Math.random() > 0.2; // 80% de probabilidad de √©xito
                        
                        if (success) {
                            statusElement.textContent = 'Connection successful!';
                            statusElement.className = 'connection-success';
                        } else {
                            statusElement.textContent = 'Connection failed. Please check your URL and token.';
                            statusElement.className = 'connection-error';
                        }
                    }, 1000);
                });
            }
            
            // Cargar URL del webhook al iniciar
            const savedWebhookUrl = localStorage.getItem('manychat_webhook_url');
            const webhookUrlInput = document.getElementById('webhook-url');
            if (webhookUrlInput) {
                if (savedWebhookUrl) {
                    webhookUrlInput.value = savedWebhookUrl;
                } else {
                    // Si no hay URL guardada, generar una nueva
                    generateWebhookUrl();
                }
            }
            
            // Cargar token
            const savedManyChatToken = localStorage.getItem('manychat_token');
            const webhookTokenInput = document.getElementById('webhook-token');
            if (webhookTokenInput && savedManyChatToken) {
                webhookTokenInput.value = savedManyChatToken;
            }
        });
        
        // Funci√≥n para alternar la visibilidad de la contrase√±a (global)
        function togglePasswordVisibility(inputId) {
            const input = document.getElementById(inputId);
            if (!input) return;
            
            const button = input.nextElementSibling;
            if (!button) return;
            
            const icon = button.querySelector('i');
            if (!icon) return;
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }
        
        // Funci√≥n para guardar configuraci√≥n de Supabase (global)
        function saveSupabaseConfig() {
            const url = document.getElementById('supabase-url')?.value || '';
            const key = document.getElementById('supabase-key')?.value || '';
            const table = document.getElementById('supabase-table')?.value || 'messages';
            
            if (!url || !key) {
                const notification = document.getElementById('notification');
                if (notification) {
                    notification.textContent = 'Please fill in all required fields';
                    notification.classList.add('show');
                    
                    setTimeout(() => {
                        notification.classList.remove('show');
                    }, 2000);
                }
                return;
            }
            
            // Guardar en localStorage
            localStorage.setItem('supabase_url', url);
            localStorage.setItem('supabase_key', key);
            localStorage.setItem('supabase_table', table);
            
            const notification = document.getElementById('notification');
            if (notification) {
                notification.textContent = 'Supabase configuration saved!';
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 2000);
            }
        }
        
        // Funci√≥n para probar la conexi√≥n con Supabase (global)
        function testSupabaseConnection() {
            const statusElement = document.getElementById('connection-status');
            if (!statusElement) return;
            
            const url = document.getElementById('supabase-url')?.value || '';
            const key = document.getElementById('supabase-key')?.value || '';
            
            if (!url || !key) {
                statusElement.textContent = 'Error: Please fill in all required fields';
                statusElement.className = 'connection-error';
                return;
            }
            
            // Simular prueba de conexi√≥n
            statusElement.textContent = 'Testing connection...';
            statusElement.className = '';
            
            // Simular respuesta despu√©s de 1 segundo
            setTimeout(() => {
                const success = Math.random() > 0.2; // 80% de probabilidad de √©xito
                
                if (success) {
                    statusElement.textContent = 'Connection successful!';
                    statusElement.className = 'connection-success';
                } else {
                    statusElement.textContent = 'Connection failed. Please check your URL and API key.';
                    statusElement.className = 'connection-error';
                }
            }, 1000);
        }

        // Funci√≥n para crear el fondo c√≥smico
        function createCosmicBackground() {
            const background = document.getElementById('gradient-background');
            if (!background) return;
            
            // Limpiar el fondo
            background.innerHTML = '';
            
            // Crear ondas
            for (let i = 0; i < 3; i++) {
                createWave(background);
            }
            
            // Crear part√≠culas
            const numParticles = Math.floor(window.innerWidth / 10);
            for (let i = 0; i < numParticles; i++) {
                createParticle(background);
            }
        }
        
        // Funci√≥n para crear una onda
        function createWave(parent) {
            const wave = document.createElement('div');
            wave.className = 'wave';
            
            // Posici√≥n aleatoria
            const posY = Math.random() * 100;
            wave.style.top = `${posY}%`;
            
            // Duraci√≥n de la animaci√≥n (entre 15 y 25 segundos)
            const duration = Math.random() * 10 + 15;
            wave.style.animationDuration = `${duration}s`;
            
            // Retraso aleatorio para que no todas empiecen al mismo tiempo
            const delay = Math.random() * 5;
            wave.style.animationDelay = `-${delay}s`;
            
            parent.appendChild(wave);
        }
        
        // Funci√≥n para crear una part√≠cula
        function createParticle(parent) {
            const particle = document.createElement('div');
            particle.className = 'particle';
            
            // Tama√±o aleatorio entre 2 y 6 p√≠xeles
            const size = Math.random() * 4 + 2;
            particle.style.width = `${size}px`;
            particle.style.height = `${size}px`;
            
            // Posici√≥n aleatoria
            const posX = Math.random() * 100;
            const posY = Math.random() * 100;
            particle.style.left = `${posX}%`;
            particle.style.top = `${posY}%`;
            
            // Duraci√≥n de la animaci√≥n (entre 5 y 15 segundos)
            const duration = Math.random() * 10 + 5;
            particle.style.animationDuration = `${duration}s`;
            
            // Retraso aleatorio para que no todas empiecen al mismo tiempo
            const delay = Math.random() * 15;
            particle.style.animationDelay = `${delay}s`;
            
            parent.appendChild(particle);
        }
        
        // Ajustar el fondo cuando cambia el tama√±o de la ventana
        window.addEventListener('resize', function() {
            createCosmicBackground();
        });
    </script>
</body>
</html> 