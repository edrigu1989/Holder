<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Webhook Configuration - M5V</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            /* Light theme variables */
            --primary: #1a73e8;
            --secondary: #5f6368;
            --success: #0f9d58;
            --danger: #d93025;
            --warning: #f9ab00;
            --bg-light: #f1f3f4;
            --bg-white: #e8eaed;
            --text-dark: #202124;
            --card-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            --border-color: #dadce0;
            --logo-primary: #1a73e8;
            --logo-shadow: rgba(26, 115, 232, 0.5);
            --font-primary: 'Inter', 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }

        /* Dark theme variables */
        html[data-theme='dark'] {
            --primary: #8ab4f8;
            --secondary: #9aa0a6;
            --success: #81c995;
            --danger: #f28b82;
            --warning: #fdd663;
            --bg-light: #202124;
            --bg-white: #292a2d;
            --text-dark: #e8eaed;
            --card-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            --border-color: #3c4043;
            --logo-primary: #8ab4f8;
            --logo-shadow: rgba(138, 180, 248, 0.5);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            transition: background-color 0.3s, color 0.3s;
        }
        
        body {
            font-family: var(--font-primary);
            background-color: var(--bg-light);
            color: var(--text-dark);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            background-color: var(--primary);
            color: white;
            padding: 20px;
            text-align: center;
            margin-bottom: 30px;
            border-radius: 8px;
            box-shadow: var(--card-shadow);
            position: relative;
        }
        
        header h1 {
            margin: 0;
            font-size: 2rem;
        }

        .back-link {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            text-decoration: none;
            display: flex;
            align-items: center;
            font-size: 16px;
        }

        .back-link:hover {
            text-decoration: underline;
        }

        /* Theme selector */
        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            background-color: rgba(255, 255, 255, 0.2);
        }

        .theme-toggle:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }
        
        .card {
            background-color: var(--bg-white);
            border-radius: 8px;
            box-shadow: var(--card-shadow);
            padding: 20px;
            margin-bottom: 30px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .card h2 {
            color: var(--primary);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        .webhook-section {
            margin-bottom: 30px;
        }

        .webhook-url {
            background-color: var(--bg-light);
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            margin: 15px 0;
            position: relative;
            word-break: break-all;
        }

        .copy-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 12px;
            transition: background-color 0.2s, transform 0.1s;
        }

        .copy-btn:hover {
            background-color: #0b5fca;
            transform: translateY(-1px);
        }
        
        .copy-btn:active {
            transform: translateY(1px);
        }

        .step {
            margin-bottom: 20px;
            padding-left: 20px;
            border-left: 3px solid var(--primary);
        }

        .step h3 {
            color: var(--primary);
            margin-bottom: 10px;
        }

        .step p {
            margin-bottom: 10px;
        }

        .step img {
            max-width: 100%;
            margin: 10px 0;
            border: 1px solid var(--border-color);
            border-radius: 5px;
        }

        .regenerate-btn {
            background-color: var(--secondary);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 10px 15px;
            cursor: pointer;
            font-size: 14px;
            display: inline-block;
            margin-top: 10px;
        }

        .regenerate-btn:hover {
            opacity: 0.9;
        }

        .token-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 15px 0;
        }
        
        .token-container input {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--bg-light);
            color: var(--text-dark);
            font-family: monospace;
        }

        .generate-token-btn {
            background-color: var(--success);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 10px 15px;
            cursor: pointer;
            font-size: 14px;
        }

        .webhook-config-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }

        .webhook-config {
            flex: 1;
            min-width: 300px;
            padding: 20px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            background-color: var(--bg-light);
        }

        .webhook-config h4 {
            margin-bottom: 12px;
            color: var(--primary);
            font-weight: 500;
        }

        .webhook-config p {
            margin-bottom: 15px;
            font-size: 15px;
            line-height: 1.5;
        }

        .webhook-config pre {
            background-color: var(--bg-white);
            padding: 12px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 13px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        }

        .config-item {
            margin-bottom: 20px;
        }

        .config-item label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 15px;
        }

        .input-with-copy {
            position: relative;
            margin-bottom: 8px;
        }

        .input-with-copy input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 14px;
            background-color: var(--bg-white);
            color: var(--text-dark);
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        }

        small {
            display: block;
            margin-top: 6px;
            color: var(--secondary);
            font-size: 13px;
        }

        .setup-steps {
            margin-top: 25px;
            margin-bottom: 25px;
            background-color: var(--bg-white);
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid var(--primary);
        }

        .setup-steps h3 {
            margin-bottom: 12px;
            color: var(--primary);
            font-size: 16px;
        }

        .setup-steps ol {
            padding-left: 20px;
        }

        .setup-steps li {
            margin-bottom: 8px;
            line-height: 1.5;
        }

        .test-webhook {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .btn {
            display: inline-block;
            padding: 10px 16px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background-color 0.2s, transform 0.1s, box-shadow 0.2s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .btn:hover {
            background-color: #0b5fca;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        
        .btn:active {
            transform: translateY(1px);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        .btn.secondary {
            background-color: var(--secondary);
        }
        
        .btn.secondary:hover {
            background-color: #4a4e52;
        }
        
        .btn.success {
            background-color: var(--success);
        }
        
        .btn.success:hover {
            background-color: #0b8548;
        }

        .status-indicator {
            font-size: 14px;
            margin-left: 10px;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: var(--secondary);
            font-size: 14px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background-color: var(--success);
            color: white;
            border-radius: 4px;
            box-shadow: var(--card-shadow);
            opacity: 0;
            transform: translateY(-20px);
            transition: opacity 0.3s, transform 0.3s;
            z-index: 1000;
        }

        .notification.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            header h1 {
                font-size: 1.5rem;
            }
            
            .card {
                padding: 15px;
            }
            
            .theme-toggle {
                top: 10px;
                right: 10px;
            }

            .back-link {
                top: 10px;
                left: 10px;
            }

            .webhook-config {
                min-width: 100%;
            }
        }

        /* Add these styles to the end of existing styles */
        .settings-form {
            background-color: var(--bg-light);
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        
        .form-group {
            margin-bottom: 15px;
            position: relative;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .form-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 14px;
            background-color: var(--bg-white);
            color: var(--text-dark);
        }
        
        .toggle-password {
            position: absolute;
            right: 10px;
            top: 32px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            color: var(--secondary);
        }
        
        .save-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 10px 15px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
            font-weight: 500;
            transition: background-color 0.2s, transform 0.1s, box-shadow 0.2s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .save-btn:hover {
            background-color: #0b5fca;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        
        .save-btn:active {
            transform: translateY(1px);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        .test-btn {
            background-color: var(--secondary);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 10px 15px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 15px;
            font-weight: 500;
            transition: background-color 0.2s, transform 0.1s, box-shadow 0.2s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .test-btn:hover {
            background-color: #4a4e52;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        
        .test-btn:active {
            transform: translateY(1px);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        .test-connection-container {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 10px;
        }
        
        #connection-status {
            font-size: 14px;
        }
        
        .connection-success {
            color: var(--success);
        }
        
        .connection-error {
            color: var(--danger);
        }

        /* Eliminar estilos de parallax que no se usarán */
        .parallax-container, .parallax-bg, .parallax-content {
            display: none;
        }

        /* Add Google Font link for Inter */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        /* JSON Structure styles */
        .json-structure {
            position: relative;
            margin-bottom: 20px;
        }
        
        .json-structure pre {
            background-color: var(--bg-white);
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.5;
            border: 1px solid var(--border-color);
            padding-right: 40px; /* Espacio para el botón de copia */
        }
        
        .json-structure h4 {
            margin-bottom: 10px;
            color: var(--primary);
            font-size: 14px;
            font-weight: 500;
        }
        
        .json-structure .copy-btn {
            top: 10px;
            right: 10px;
            z-index: 10;
        }

        /* Info box styles */
        .info-box {
            background-color: var(--bg-white);
            border-left: 4px solid var(--primary);
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }
        
        .info-box i {
            color: var(--primary);
            font-size: 18px;
            margin-top: 2px;
        }
        
        .info-box p {
            margin: 0;
            font-size: 14px;
            line-height: 1.5;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Webhook Configuration</h1>
            <a href="index.html" class="back-link"><i class="fas fa-arrow-left"></i> Back to Dashboard</a>
            <button class="theme-toggle" id="theme-toggle" title="Toggle Theme">
                <i class="fas fa-sun"></i>
            </button>
        </header>

        <div class="card">
            <h2>ManyChat Integration</h2>
            <p>Configure your ManyChat webhook to connect with our system.</p>
            
            <div class="webhook-config">
                <div class="config-item">
                    <label>Webhook URL:</label>
                    <div class="input-with-copy">
                        <input type="text" id="manychat-url" value="https://api.m5v.io/webhooks/manychat" readonly>
                        <button class="copy-btn" data-target="manychat-url"><i class="fas fa-copy"></i></button>
                    </div>
                    <small>Use this URL in your ManyChat webhook settings.</small>
                </div>
                
                <div class="config-item">
                    <label>Authentication Token:</label>
                    <div class="input-with-copy">
                        <input type="text" id="manychat-token" value="mc_12345" placeholder="Enter a simple token">
                        <button class="copy-btn" data-target="manychat-token"><i class="fas fa-copy"></i></button>
                    </div>
                    <small>Add this token to your webhook headers for authentication.</small>
                </div>
                
                <div class="config-item">
                    <label>Generate New Webhook:</label>
                    <button class="btn secondary" id="generate-webhook">Generate New Webhook</button>
                    <small>Click to generate a new webhook URL and path if needed.</small>
                </div>
                
                <div class="config-item">
                    <label>JSON Structure:</label>
                    <div class="json-structure">
                        <h4>Request Format (ManyChat to System):</h4>
                        <pre id="request-json">{
  "user": {
    "id": "{{user_id}}",
    "name": "{{first_name}} {{last_name}}",
    "phone": "{{phone}}",
    "email": "{{email}}"
  },
  "message": {
    "text": "{{last_input_text}}",
    "timestamp": "{{current_date}}"
  },
  "metadata": {
    "platform": "facebook",
    "source": "messenger",
    "flow_id": "{{flow_id}}"
  }
}</pre>
                        <button class="copy-btn" data-target="request-json"><i class="fas fa-copy"></i></button>
                    </div>
                    <div class="json-structure">
                        <h4>Response Format (System to ManyChat):</h4>
                        <pre id="response-json">{
  "success": true,
  "conversation_id": "conv_{{user_id}}",
  "response": {
    "text": "Thank you for your message. Our system is processing your request.",
    "timestamp": "{{current_date}}"
  },
  "action": "process_request",
  "status": "pending"
}</pre>
                        <button class="copy-btn" data-target="response-json"><i class="fas fa-copy"></i></button>
                    </div>
                    <small>Use these JSON structures as reference for your webhook integration. ManyChat variables like {{user_id}} will be replaced with actual values.</small>
                </div>
                
                <div class="setup-steps">
                    <h3>Setup Steps:</h3>
                    <ol>
                        <li>Go to your ManyChat dashboard</li>
                        <li>Navigate to Settings > Integrations > Webhooks</li>
                        <li>Add a new webhook with the URL above</li>
                        <li>Set the content type to "application/json"</li>
                        <li>Add a header "Authorization" with the token above</li>
                        <li>Save your settings</li>
                    </ol>
                </div>
                
                <div class="test-webhook">
                    <button class="btn" id="test-manychat">Test Connection</button>
                    <span class="status-indicator" id="manychat-status"></span>
                </div>
            </div>
        </div>
        
        <!-- Nueva sección para ManyChat API Integration -->
        <div class="card">
            <h2>ManyChat API Integration</h2>
            <p>Connect directly to ManyChat API to send messages and manage subscribers.</p>
            
            <div class="webhook-config">
                <div class="config-item">
                    <label>ManyChat API Key:</label>
                    <div class="input-with-copy">
                        <input type="password" id="manychat-api-key" placeholder="Enter your ManyChat API Key">
                        <button class="toggle-password" onclick="togglePasswordVisibility('manychat-api-key')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    <small>Get this from your ManyChat dashboard under Settings > API.</small>
                </div>
                
                <div class="config-item">
                    <label>Page ID:</label>
                    <div class="input-with-copy">
                        <input type="text" id="manychat-page-id" placeholder="Enter your Facebook Page ID">
                    </div>
                    <small>Your Facebook Page ID associated with ManyChat.</small>
                </div>
                
                <div class="config-item">
                    <label>API Actions:</label>
                    <div class="api-actions">
                        <button class="btn secondary" id="get-subscribers">Get Subscribers</button>
                        <button class="btn secondary" id="get-tags">Get Tags</button>
                        <button class="btn secondary" id="get-flows">Get Flows</button>
                    </div>
                    <small>Test API functionality by retrieving data from ManyChat.</small>
                </div>
                
                <div class="config-item">
                    <label>API Response:</label>
                    <div class="json-structure">
                        <pre id="api-response" style="min-height: 150px;">// API response will appear here</pre>
                    </div>
                </div>
                
                <div class="config-item">
                    <label>Example API Usage:</label>
                    <div class="json-structure">
                        <h4>Send Message to Subscriber:</h4>
                        <pre id="send-message-example">{
  "subscriber_id": "subscriber_id_here",
  "data": {
    "messages": [
      {
        "type": "text",
        "text": "Hello from your application!"
      }
    ]
  }
}</pre>
                        <button class="copy-btn" data-target="send-message-example"><i class="fas fa-copy"></i></button>
                    </div>
                    <div class="json-structure">
                        <h4>Add Tag to Subscriber:</h4>
                        <pre id="add-tag-example">{
  "subscriber_id": "subscriber_id_here",
  "tag_name": "your_tag_name"
}</pre>
                        <button class="copy-btn" data-target="add-tag-example"><i class="fas fa-copy"></i></button>
                    </div>
                </div>
                
                <div class="setup-steps">
                    <h3>Integration Steps:</h3>
                    <ol>
                        <li>Go to your ManyChat dashboard</li>
                        <li>Navigate to Settings > API</li>
                        <li>Generate a new API Key</li>
                        <li>Copy and paste the API Key above</li>
                        <li>Save your settings</li>
                        <li>Use the API to send messages, manage subscribers, and more</li>
                    </ol>
                </div>
                
                <div class="test-webhook">
                    <button class="btn success" id="save-manychat-api">Save API Configuration</button>
                    <button class="btn" id="test-manychat-api">Test API Connection</button>
                    <span class="status-indicator" id="manychat-api-status"></span>
                </div>
            </div>
        </div>
        
        <!-- Nueva sección para ManyChat JSON App -->
        <div class="card">
            <h2>ManyChat JSON App Example</h2>
            <p>Use this JSON structure to create a custom app in ManyChat that integrates with our system.</p>
            
            <div class="webhook-config">
                <div class="config-item">
                    <label>ManyChat JSON App Structure:</label>
                    <div class="json-structure">
                        <pre id="manychat-json-app">{
  "name": "M5V Integration",
  "type": "webhook",
  "request": {
    "url": "{{Your Webhook URL}}",
    "method": "POST",
    "headers": [
      {
        "name": "Content-Type",
        "value": "application/json"
      },
      {
        "name": "Authorization",
        "value": "{{Your Auth Token}}"
      }
    ],
    "body": {
      "user": {
        "id": "{{user_id}}",
        "name": "{{first_name}} {{last_name}}",
        "phone": "{{phone}}",
        "email": "{{email}}"
      },
      "message": {
        "text": "{{last_input_text}}",
        "timestamp": "{{current_date}}"
      },
      "metadata": {
        "platform": "facebook",
        "source": "messenger",
        "flow_id": "{{flow_id}}",
        "page_id": "{{page_id}}"
      },
      "custom_fields": {
        "weight": "{{custom_field.weight}}",
        "height": "{{custom_field.height}}",
        "preferences": "{{custom_field.preferences}}"
      }
    }
  },
  "response": {
    "success_path": "$.success",
    "data_path": "$.data",
    "error_path": "$.error"
  }
}</pre>
                        <button class="copy-btn" data-target="manychat-json-app"><i class="fas fa-copy"></i></button>
                    </div>
                    <small>Copy this JSON structure and use it in ManyChat to create a custom app that integrates with our system. Replace {{Your Webhook URL}} and {{Your Auth Token}} with your actual values.</small>
                </div>
                
                <div class="config-item">
                    <label>Pokémon Integration Example:</label>
                    <div class="json-structure">
                        <pre id="pokemon-json-app">{
  "sources": [
    {
      "name": "pokemon_list",
      "type": "enum:rpc",
      "request": {
        "url": "https://pokeapi.co/api/v2/pokemon/",
        "method": "GET",
        "headers": [
          {
            "Content-Type": "application/json"
          }
        ]
      },
      "mapping": [
        {
          "type": "select",
          "path": "$.results",
          "key": "$.name",
          "value": "$.url"
        }
      ],
      "payload": null
    }
  ],
  "fields": [
    {
      "name": "weight",
      "path": "$.weight",
      "type": "number",
      "title": "Pokémon weight"
    }
  ],
  "payload": null,
  "description": "quiz game with random questions"
}</pre>
                        <button class="copy-btn" data-target="pokemon-json-app"><i class="fas fa-copy"></i></button>
                    </div>
                    <small>This example shows how to integrate with the Pokémon API to fetch a list of Pokémon and their details. You can use this as a template for your own custom integrations.</small>
                </div>
                
                <div class="info-box">
                    <i class="fas fa-info-circle"></i>
                    <p>This JSON structure is compatible with ManyChat's custom app feature. You can customize the fields and structure based on your specific needs. The example includes user data, message content, and metadata that will be sent to your webhook.</p>
                </div>
                
                <div class="setup-steps">
                    <h3>How to Use This JSON in ManyChat:</h3>
                    <ol>
                        <li>Go to your ManyChat dashboard</li>
                        <li>Navigate to Settings > Custom App</li>
                        <li>Create a new app</li>
                        <li>Paste this JSON structure</li>
                        <li>Replace the placeholders with your actual values</li>
                        <li>Save and activate your app</li>
                    </ol>
                </div>
            </div>
        </div>
        
        <div class="card">
            <h2>n8n Integration</h2>
            <p>Configure n8n to process your webhook data.</p>
            
            <div class="webhook-config">
                <div class="config-item">
                    <label>Webhook URL (from n8n):</label>
                    <div class="input-with-copy">
                        <input type="text" id="n8n-url" placeholder="Enter your n8n webhook URL here">
                        <button class="copy-btn" data-target="n8n-url"><i class="fas fa-copy"></i></button>
                    </div>
                    <small>Enter the webhook URL provided by your n8n instance. Example: https://primary-production-cdd4.up.railway.app/webhook-test/whatsapp</small>
                </div>
                
                <div class="config-item">
                    <label>Authentication Token:</label>
                    <div class="input-with-copy">
                        <input type="text" id="n8n-token" value="n8n_67890" placeholder="Enter a simple token">
                        <button class="copy-btn" data-target="n8n-token"><i class="fas fa-copy"></i></button>
                    </div>
                    <small>Add this token to your n8n webhook node for authentication.</small>
                </div>
                
                <div class="setup-steps">
                    <h3>Setup Steps for n8n:</h3>
                    <ol>
                        <li>Open your n8n instance</li>
                        <li>Create a new workflow or edit an existing one</li>
                        <li>Add a "Webhook" trigger node</li>
                        <li>Set HTTP Method to "POST"</li>
                        <li>Enable "Respond to Webhook" and select "When last node finishes"</li>
                        <li>Copy the webhook URL from n8n and paste it above</li>
                        <li>Add the authentication token to your workflow</li>
                        <li>Save your workflow and activate it</li>
                    </ol>
                </div>
                
                <div class="test-webhook">
                    <button class="btn primary" id="save-n8n">Save Configuration</button>
                    <button class="btn secondary" id="test-n8n">Test Connection</button>
                    <span class="status-indicator" id="n8n-status"></span>
                </div>
            </div>
        </div>
        
        <div class="card">
            <h2>Advanced Settings</h2>
            <p>Configure additional webhook settings.</p>
            
            <div class="webhook-config">
                <div class="config-item">
                    <label>Retry Attempts:</label>
                    <select id="retry-attempts">
                        <option value="1">1</option>
                        <option value="3" selected>3</option>
                        <option value="5">5</option>
                        <option value="10">10</option>
                    </select>
                    <small>Number of retry attempts if a webhook fails.</small>
                </div>
                
                <div class="config-item">
                    <label>Timeout (seconds):</label>
                    <input type="number" id="timeout" value="30" min="5" max="120">
                    <small>Maximum time to wait for a webhook response.</small>
                </div>
                
                <div class="config-item">
                    <label>Logging Level:</label>
                    <select id="logging-level">
                        <option value="error">Error Only</option>
                        <option value="warning">Warning & Error</option>
                        <option value="info" selected>Info, Warning & Error</option>
                        <option value="debug">Debug (Verbose)</option>
                    </select>
                    <small>Level of detail for webhook logs.</small>
                </div>
                
                <div class="test-webhook">
                    <button class="btn success" id="save-advanced">Save Settings</button>
                </div>
            </div>
        </div>
        
        <!-- Restaurando la sección de Supabase -->
        <div class="card">
            <h2>Supabase Connection</h2>
            <p>Configure connection with Supabase to store messages and webhook data:</p>
            
            <div class="webhook-section">
                <div class="settings-form">
                    <div class="form-group">
                        <label for="supabase-url">Supabase URL:</label>
                        <input type="text" id="supabase-url" placeholder="Ex: https://abcdefghijklm.supabase.co" value="">
                    </div>
                    
                    <div class="form-group">
                        <label for="supabase-key">Supabase API Key:</label>
                        <input type="password" id="supabase-key" placeholder="Enter your Supabase API Key" value="">
                        <button type="button" class="toggle-password" onclick="togglePasswordVisibility('supabase-key')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    
                    <div class="form-group">
                        <label for="supabase-table">Table Name:</label>
                        <input type="text" id="supabase-table" placeholder="Ex: messages" value="messages">
                    </div>
                    
                    <div class="form-group">
                        <div class="info-box">
                            <i class="fas fa-info-circle"></i>
                            <p>Supabase connection is required for the webhook system to store and retrieve messages. Without this connection, the system will not be able to maintain conversation history.</p>
                        </div>
                    </div>
                    
                    <button class="save-btn" onclick="saveSupabaseConfig()">Save Supabase Configuration</button>
                </div>
                
                <div class="test-connection-container">
                    <button class="test-btn" onclick="testSupabaseConnection()">Test Connection</button>
                    <span id="connection-status"></span>
                </div>
            </div>
        </div>
        
        <footer>
            <p>M5V Developments &copy; 2023 - Webhook Configuration</p>
        </footer>
    </div>

    <div class="notification" id="notification">Copied to clipboard!</div>
    
    <!-- Link to JavaScript file -->
    <script src="webhook-settings.js"></script>

    <script>
        // Initialize the interface
        document.addEventListener('DOMContentLoaded', function() {
            // Theme selector configuration
            const htmlElement = document.documentElement;
            const themeToggle = document.getElementById('theme-toggle');
            
            // Load saved theme
            const savedTheme = localStorage.getItem('theme') || 'light';
            htmlElement.setAttribute('data-theme', savedTheme);
            updateThemeToggleIcon(savedTheme);
            
            // Function to toggle theme
            themeToggle.addEventListener('click', () => {
                const currentTheme = htmlElement.getAttribute('data-theme');
                const newTheme = currentTheme === 'light' ? 'dark' : 'light';
                
                htmlElement.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                
                updateThemeToggleIcon(newTheme);
            });
            
            function updateThemeToggleIcon(theme) {
                themeToggle.innerHTML = theme === 'light' ? 
                    '<i class="fas fa-sun"></i>' : 
                    '<i class="fas fa-moon"></i>';
            }
            
            // Generar URL dinámica basada en la ubicación actual
            const generateWebhookUrl = function() {
                // Obtener el dominio actual
                const currentDomain = window.location.origin;
                
                // Crear la URL del webhook
                const webhookUrl = `${currentDomain}/api/webhooks/manychat`;
                
                // Actualizar el campo de entrada
                document.getElementById('manychat-url').value = webhookUrl;
            };
            
            // Generar la URL al cargar la página
            generateWebhookUrl();
            
            // Función para generar un webhook aleatorio
            const generateRandomWebhook = function() {
                // Generar un identificador aleatorio para el webhook
                const randomId = Math.random().toString(36).substring(2, 8);
                
                // Obtener el dominio actual
                const currentDomain = window.location.origin;
                
                // Crear la nueva URL del webhook con el identificador aleatorio
                const newWebhookUrl = `${currentDomain}/api/webhooks/manychat-${randomId}`;
                
                // Actualizar el campo de entrada
                document.getElementById('manychat-url').value = newWebhookUrl;
                
                // Generar un token simple
                const simpleToken = `mc_${randomId}`;
                document.getElementById('manychat-token').value = simpleToken;
                
                // Guardar en localStorage
                localStorage.setItem('manychat_webhook_url', newWebhookUrl);
                localStorage.setItem('manychat_token', simpleToken);
            };
            
            // Evento para el botón de generar webhook
            document.getElementById('generate-webhook').addEventListener('click', function() {
                generateRandomWebhook();
                
                // Mostrar notificación
                notification.textContent = 'New webhook generated!';
                notification.classList.add('show');
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 2000);
            });
            
            // Función para copiar al portapapeles
            const copyButtons = document.querySelectorAll('.copy-btn');
            const notification = document.getElementById('notification');
            
            copyButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const targetId = this.getAttribute('data-target');
                    const inputElement = document.getElementById(targetId);
                    
                    // Seleccionar el texto
                    inputElement.select();
                    inputElement.setSelectionRange(0, 99999); // Para dispositivos móviles
                    
                    // Copiar al portapapeles
                    document.execCommand('copy');
                    
                    // Mostrar notificación
                    notification.classList.add('show');
                    setTimeout(() => {
                        notification.classList.remove('show');
                    }, 2000);
                });
            });
            
            // Función para alternar la visibilidad de la contraseña
            window.togglePasswordVisibility = function(inputId) {
                const input = document.getElementById(inputId);
                const icon = input.nextElementSibling.querySelector('i');
                
                if (input.type === 'password') {
                    input.type = 'text';
                    icon.classList.remove('fa-eye');
                    icon.classList.add('fa-eye-slash');
                } else {
                    input.type = 'password';
                    icon.classList.remove('fa-eye-slash');
                    icon.classList.add('fa-eye');
                }
            };
            
            // Simulación de guardar configuración de Supabase
            window.saveSupabaseConfig = function() {
                const url = document.getElementById('supabase-url').value;
                const key = document.getElementById('supabase-key').value;
                const table = document.getElementById('supabase-table').value;
                
                if (!url || !key) {
                    alert('Please fill in all required fields');
                    return;
                }
                
                // Aquí se guardaría la configuración en localStorage o se enviaría a un servidor
                localStorage.setItem('supabase_url', url);
                localStorage.setItem('supabase_table', table);
                // No guardar la clave en localStorage en una aplicación real
                
                alert('Supabase configuration saved successfully. Your webhook system is now ready to store and retrieve messages.');
            };
            
            // Simulación de prueba de conexión con Supabase
            window.testSupabaseConnection = function() {
                const url = document.getElementById('supabase-url').value;
                const key = document.getElementById('supabase-key').value;
                const statusElement = document.getElementById('connection-status');
                
                if (!url || !key) {
                    statusElement.textContent = 'Please fill in all required fields';
                    statusElement.className = 'connection-error';
                    return;
                }
                
                // Simulación de prueba de conexión
                statusElement.textContent = 'Testing connection...';
                statusElement.className = '';
                
                // Realizar una prueba real de conexión a Supabase
                try {
                    // En una implementación real, aquí se haría una llamada a la API de Supabase
                    // Por ahora, solo verificamos el formato de la URL
                    setTimeout(() => {
                        if (url.includes('supabase.co')) {
                            statusElement.textContent = 'Connection successful!';
                            statusElement.className = 'connection-success';
                        } else {
                            statusElement.textContent = 'Connection failed. Invalid URL format.';
                            statusElement.className = 'connection-error';
                        }
                    }, 1500);
                } catch (error) {
                    statusElement.textContent = 'Connection failed: ' + error.message;
                    statusElement.className = 'connection-error';
                }
            };
            
            // Eventos para los botones de prueba
            document.getElementById('test-manychat').addEventListener('click', function() {
                const statusElement = document.getElementById('manychat-status');
                const webhookUrl = document.getElementById('manychat-url').value;
                const token = document.getElementById('manychat-token').value;
                
                if (!webhookUrl || !token) {
                    statusElement.textContent = 'Please ensure webhook URL and token are set';
                    statusElement.style.color = 'var(--danger)';
                    return;
                }
                
                statusElement.textContent = 'Testing connection...';
                statusElement.style.color = '';
                
                // Realizar una prueba real de conexión
                // En una implementación real, aquí se haría una llamada al webhook
                try {
                    // Simulación de prueba de conexión
                    setTimeout(() => {
                        // Verificar si Supabase está configurado
                        const supabaseUrl = localStorage.getItem('supabase_url');
                        if (!supabaseUrl) {
                            statusElement.textContent = 'Warning: Supabase not configured. Webhook will work but messages won\'t be stored.';
                            statusElement.style.color = 'var(--warning)';
                        } else {
                            statusElement.textContent = 'Connection successful!';
                            statusElement.style.color = 'var(--success)';
                        }
                    }, 1500);
                } catch (error) {
                    statusElement.textContent = 'Connection failed: ' + error.message;
                    statusElement.style.color = 'var(--danger)';
                }
            });
            
            document.getElementById('test-n8n').addEventListener('click', function() {
                const n8nUrl = document.getElementById('n8n-url').value;
                const n8nToken = document.getElementById('n8n-token').value;
                const statusElement = document.getElementById('n8n-status');
                
                if (!n8nUrl) {
                    statusElement.textContent = 'Please enter n8n webhook URL';
                    statusElement.style.color = 'var(--danger)';
                    return;
                }
                
                statusElement.textContent = 'Testing connection...';
                statusElement.style.color = '';
                
                // Realizar una prueba real de conexión a n8n
                try {
                    // En una implementación real, aquí se haría una llamada al webhook de n8n
                    // Por ahora, solo verificamos el formato de la URL
                    setTimeout(() => {
                        if (n8nUrl.includes('webhook') || n8nUrl.includes('n8n')) {
                            statusElement.textContent = 'Connection successful!';
                            statusElement.style.color = 'var(--success)';
                        } else {
                            statusElement.textContent = 'Warning: URL may not be a valid n8n webhook';
                            statusElement.style.color = 'var(--warning)';
                        }
                    }, 1500);
                } catch (error) {
                    statusElement.textContent = 'Connection failed: ' + error.message;
                    statusElement.style.color = 'var(--danger)';
                }
            });
            
            document.getElementById('save-n8n').addEventListener('click', function() {
                const n8nUrl = document.getElementById('n8n-url').value;
                
                if (!n8nUrl) {
                    alert('Please enter n8n webhook URL');
                    return;
                }
                
                // Guardar en localStorage
                localStorage.setItem('n8n_webhook_url', n8nUrl);
                alert('n8n configuration saved successfully');
            });
            
            document.getElementById('save-advanced').addEventListener('click', function() {
                const retryAttempts = document.getElementById('retry-attempts').value;
                const timeout = document.getElementById('timeout').value;
                const loggingLevel = document.getElementById('logging-level').value;
                
                // Guardar en localStorage
                localStorage.setItem('webhook_retry_attempts', retryAttempts);
                localStorage.setItem('webhook_timeout', timeout);
                localStorage.setItem('webhook_logging_level', loggingLevel);
                
                alert('Advanced settings saved successfully');
            });
            
            // Cargar valores guardados
            const loadSavedValues = function() {
                // Webhook URL
                const savedWebhookUrl = localStorage.getItem('manychat_webhook_url');
                if (savedWebhookUrl) {
                    document.getElementById('manychat-url').value = savedWebhookUrl;
                } else {
                    // Si no hay URL guardada, generar una nueva
                    generateWebhookUrl();
                }
                
                // ManyChat token
                const savedManyChatToken = localStorage.getItem('manychat_token');
                if (savedManyChatToken) {
                    document.getElementById('manychat-token').value = savedManyChatToken;
                }
                
                // n8n URL
                const savedN8nUrl = localStorage.getItem('n8n_webhook_url');
                if (savedN8nUrl) {
                    document.getElementById('n8n-url').value = savedN8nUrl;
                }
                
                // Supabase
                const savedSupabaseUrl = localStorage.getItem('supabase_url');
                const savedSupabaseTable = localStorage.getItem('supabase_table');
                
                if (savedSupabaseUrl) {
                    document.getElementById('supabase-url').value = savedSupabaseUrl;
                }
                
                if (savedSupabaseTable) {
                    document.getElementById('supabase-table').value = savedSupabaseTable;
                }
                
                // Advanced settings
                const savedRetryAttempts = localStorage.getItem('webhook_retry_attempts');
                const savedTimeout = localStorage.getItem('webhook_timeout');
                const savedLoggingLevel = localStorage.getItem('webhook_logging_level');
                
                if (savedRetryAttempts) {
                    document.getElementById('retry-attempts').value = savedRetryAttempts;
                }
                
                if (savedTimeout) {
                    document.getElementById('timeout').value = savedTimeout;
                }
                
                if (savedLoggingLevel) {
                    document.getElementById('logging-level').value = savedLoggingLevel;
                }
            };
            
            // Cargar valores guardados al iniciar
            loadSavedValues();
        });
    </script>
</body>
</html> 